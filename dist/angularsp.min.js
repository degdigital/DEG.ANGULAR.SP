var app=app||angular.module("angularSP",["ui.bootstrap"]);(function(e,t){app.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){if(!a){return}function r(){var e=t.html();if(e==="<br>"){a.$setViewValue("")}else{a.$setViewValue(e)}}a.$render=function(){t.html(a.$viewValue||"")};t.bind("blur keyup change",function(){e.$apply(r)})}}});app.directive("ngspColumn",n);function n(e){return{restrict:"A",require:"ngModel",scope:{ngspColumn:"=",ngModel:"="},link:n};function n(e,t,n,l){e.ngspColumn={};e.$watch("ngspColumn",function(){if(e.ngspColumn.Title!==undefined&&e.ngspColumn.InputType!==undefined){t.html("");t.append(a(e.ngspColumn));t.append(r(t,l,e))}})}function a(e){var n=t("<label></label>");n.text(e.Title);return n}function r(e,t,n){switch(n.ngspColumn.InputType){case"text":return l(t,n);break;case"textBox":return o(t,n);break;case"nicEdit":return i(t,n);break;case"dropDown":return u(t,n);break;case"radio":return p(t,n);break;case"checkbox":return s(t,n);break;case"dateTime":return c(t,n);break;case"peoplePicker":return d(e,t,n);break;default:console.log(n.ngspColumn.InputType+" is currently unsupported as an input type.");break}}function l(n,a){n.$formatters.push(function(e){a.InputValue=e});a.textInputChanged=function(){n.$setViewValue(a.InputValue)};var r=t("<input />");r.attr("data-ng-model","InputValue");r.attr("data-ng-change","textInputChanged()");if(a.ngspColumn.Type==="text"){}else if(a.ngspColumn.Type==="link"){}else if(a.ngspColumn.Type==="number"){}else if(a.ngspColumn.Type==="currency"){}else{console.log(a.ngspColumn.Type+"is not supported as a column type for text input.");return}e(r)(a);return r}function o(n,a){n.$formatters.push(function(e){a.InputValue=e});a.textAreaChanged=function(){n.$setViewValue(a.InputValue)};var r=t("<textarea></textarea>");r.attr("data-ng-model","InputValue");r.attr("data-ng-change","textAreaChanged()");if(a.ngspColumn.Type==="multiText"){}else{console.log(a.ngspColumn.Type+"is not supported as a column type for text box.");return}e(r)(a);return r}function i(n,a){n.$formatters.push(function(e){a.InputValue=e});var r=t("<span></span>");var l=t("<div></div>");r.append(l);var o=t("<div></div>");o.attr("contenteditable","true");o.attr("data-ng-model","InputValue");r.append(o);var i={iconsPath:"/AngularSP/lib/images/nicEditorIcons.gif"};var u=new nicEditor(i);u.setPanel(l[0]);u.addInstance(o[0]);if(a.ngspColumn.Type==="multiText"){}else{console.log(a.ngspColumn.Type+"is not supported as a column type for nicEdit.");return}e(r)(a);a.$watch("InputValue",function(){n.$setViewValue(a.InputValue)});return r}function u(n,a){n.$formatters.push(function(e){a.InputValue=e});a.dropDownChanged=function(){n.$setViewValue(a.InputValue)};var r=t("<select></select>");r.attr("data-ng-model","InputValue");r.attr("data-ng-change","dropDownChanged()");if(a.ngspColumn.Type==="choice"){r.attr("data-ng-options","choice for choice in ngspColumn.Choices")}else if(a.ngspColumn.Type==="lookup"){r.attr("data-ng-options","lookupItem.id as lookupItem.label for lookupItem in ngspColumn.LookupItems")}else if(a.ngspColumn.Type==="metadata"){r.attr("data-ng-options","term.id as term.label for term in ngspColumn.Terms")}else{console.log(a.ngspColumn.Type+"is not supported as a column type for dropdown menus.");return}e(r)(a);return r}function s(n,a){n.$formatters.push(function(e){a.InputValue=e});a.checkboxChanged=function(){n.$setViewValue(a.InputValue)};var r=t("<span></span>");if(a.ngspColumn.Type==="multiMetadata"||a.ngspColumn.Type==="multiLookup"||a.ngspColumn.Type==="multiChoice"){var l=t("<span></span>");var o=t("<input />");o.attr("data-ng-change","checkboxChanged()");var i=t("<label></label>");o.attr("type","checkbox");if(a.ngspColumn.Type==="multiMetadata"){l.attr("data-ng-repeat","term in ngspColumn.Terms");o.attr("data-ng-model","InputValue[term.id]");i.text("{{term.label}}")}else if(a.ngspColumn.Type==="multiLookup"){l.attr("data-ng-repeat","lookupItem in ngspColumn.LookupItems");o.attr("data-ng-model","InputValue[lookupItem.id]");i.text("{{lookupItem.label}}")}else if(a.ngspColumn.Type==="multiChoice"){l.attr("data-ng-repeat","choice in ngspColumn.Choices");o.attr("data-ng-model","InputValue[choice]");i.text("{{choice}}")}l.append(o);l.append(i)}else if(a.ngspColumn.Type==="yesNo"){var o=t("<input />");o.attr("type","checkbox");o.attr("data-ng-model","InputValue");o.attr("data-ng-change","checkboxChanged()");r.append(o)}else{console.log(a.ngspColumn.Type+"is not supported as a column type for checkboxes.");return}r.append(l);e(r)(a);return r}function p(n,a){n.$formatters.push(function(e){a.InputValue=e});a.radioChanged=function(){console.log(a.InputValue);if(a.ngspColumn.Type==="yesNo"){if(a.InputValue==="yes"){n.$setViewValue(true)}else{n.$setViewValue(false)}}else{n.$setViewValue(a.InputValue)}};var r=t("<span></span>");var l=a.ngspColumn.Title;if(a.ngspColumn.Type==="yesNo"){var o=t("<span></span>");var i=t("<input></input>");i.attr("type","radio");i.attr("data-ng-model","InputValue");i.attr("data-ng-change","radioChanged()");i.attr("name",l);i.attr("value","yes");o.append(i);var u=t("<label></label>");u.text("Yes");o.append(u);var s=t("<span></span>");var p=t("<input></input>");p.attr("type","radio");p.attr("data-ng-model","InputValue");p.attr("data-ng-change","radioChanged()");p.attr("name",l);p.attr("value","no");s.append(p);var c=t("<label></label>");c.text("No");s.append(c);r.append(o);r.append(s)}else if(a.ngspColumn.Type==="choice"){var d=t("<span></span>");d.attr("data-ng-repeat","choice in ngspColumn.Choices");var f=t("<input></input>");f.attr("type","radio");f.attr("data-ng-change","radioChanged()");f.attr("data-ng-model","$parent.InputValue");f.attr("name",l);f.attr("value","{{choice}}");var m=t("<label></label>");m.text("{{choice}}");d.append(f);d.append(m);r.append(d)}else if(a.ngspColumn.Type==="lookup"){var g=t("<span></span>");g.attr("data-ng-repeat","lookupItem in ngspColumn.LookupItems");var f=t("<input></input>");f.attr("type","radio");f.attr("data-ng-change","radioChanged()");f.attr("data-ng-model","$parent.InputValue");f.attr("name",l);f.attr("value","{{lookupItem.id}}");var m=t("<label></label>");m.text("{{lookupItem.label}}");g.append(f);g.append(m);r.append(g)}else if(a.ngspColumn.Type==="metadata"){var v=t("<span></span>");v.attr("data-ng-repeat","term in ngspColumn.Terms");var f=t("<input></input>");f.attr("type","radio");f.attr("data-ng-change","radioChanged()");f.attr("data-ng-model","$parent.InputValue");f.attr("name",l);f.attr("value","{{term.id}}");var m=t("<label></label>");m.text("{{term.label}}");v.append(f);v.append(m);r.append(v)}else{console.log(a.ngspColumn.Type+"is not supported as a column type for radio input.");return}e(r)(a);return r}function c(n,a){a.InputValue={};n.$formatters.push(function(e){a.InputValue.Date=e;a.InputValue.Time=e});a.calendarOpened=false;a.calendarFormat="yyyy-MM-dd";a.openCalendar=function(e){e.preventDefault();e.stopPropagation();a.calendarOpened=true};a.dateTimeChanged=function(){var e=new Date;if(a.InputValue.Date!==undefined){e.setFullYear(a.InputValue.Date.getFullYear());e.setMonth(a.InputValue.Date.getMonth());e.setDate(a.InputValue.Date.getDate())}if(a.InputValue.Time!==undefined){e.setHours(a.InputValue.Time.getHours());e.setMinutes(a.InputValue.Time.getMinutes())}e.setSeconds(0);n.$setViewValue(e)};var r=t("<span></span>");r.attr("class","input-group");var l=t("<span></span>");l.attr("class","input-group");var o=t("<input />");o.attr("class","form-control");o.attr("data-ng-model","InputValue.Date");o.attr("data-datepicker-popup","{{calendarFormat}}");o.attr("data-is-open","calendarOpened");o.attr("data-ng-change","dateTimeChanged()");l.append(o);var i=t("<span></span>");i.attr("class","input-group-btn");var u=t("<button></button>");u.attr("class","btn btn-default");u.attr("data-ng-click","openCalendar($event)");var s=t("<i></i>");s.attr("class","glyphicon glyphicon-calendar");u.append(s);i.append(u);l.append(i);r.append(l);var p=t("<timepicker></timepicker>");p.attr("data-ng-model","InputValue.Time");p.attr("data-ng-change","dateTimeChanged()");r.append(p);e(r)(a);return r}function d(n,a,r){if(a.$viewValue!==undefined){r.InputValue=a.$viewValue}else{r.InputValue=null}var l="pp_"+r.ngspColumn.Title+"_"+r.ngspColumn.Id;var o=t("<span></span>");o.attr("id",l);e(o)(r);var i={SearchPrincipalSource:15,ResolvePrincipalSource:15,MaximumEntitySuggestions:50,Width:"100%",OnUserResolvedClientScript:u};i.Required=r.ngspColumn.IsRequired;if(r.ngspColumn.PeopleOnly){i.PrincipalAccountType="User,DL"}else{i.PrincipalAccountType="User,DL,SecGroup,SPGroup"}if(r.ngspColumn.Type==="person"){i.AllowMultipleValues=false}else if(r.ngspColumn.Type==="multiPerson"){i.AllowMultipleValues=true}else{console.log(r.ngspColumn.Type+"is not supported as a column type for people pickers.");return}r.$watch(n[0].childNodes.length,function(){var e=t("#"+l);if(e.length>0){SPClientPeoplePicker_InitStandaloneControlWrapper(l,r.InputValue,i);a.$formatters.push(function(e){SPClientPeoplePicker_InitStandaloneControlWrapper(l,e,i)})}});function u(){var e=l+"_TopSpan";var t=SPClientPeoplePicker.SPClientPeoplePickerDict[e];r.InputValue=t.GetAllUserInfo();a.$setViewValue(r.InputValue)}return o}}app.directive("ngspList",a);function a(e){return{restrict:"A",scope:{ngspList:"="},link:t};function t(e,t,n){e.ngspList={};e.$watch("ngspList",function(){if(e.ngspList.DisplayName!==undefined&&e.ngspList.Columns!==undefined){t.html("");t.append(generateTitleElement(e.ngspList));t.append(generateGridElement());t.append(generateButtonsElement(t,e))}})}}})(angular,jQuery);var app=app||angular.module("angularSP",["ui.bootstrap"]);(function(e,t){app.factory("spListFactory",["$rootScope","$q",n]);function n(n,a){var r={initFactory:f,createListItem:m,createListItems:g,getListItem:v,getListItems:y,updateListItem:h,deleteListItem:T,getServerRelativeUrl:d};var l;var o;var i;var u;var s;var p;var c;return r;function d(){return l}function f(t,r,i){o=t;o=r;u=i;s=e.copy(t);p=e.copy(r);c=e.copy(i);b(s,p,c);var d=a.defer();SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",f)})});return d.promise;function f(){var e=SP.ClientContext.get_current();var t=e.get_web();e.load(t,"ServerRelativeUrl");var a=L(i);e.executeQueryAsync(r,o);function r(){l=t.get_serverRelativeUrl();var r=B(c,a);e.executeQueryAsync(o,i);function o(){r.forEach(function(e){e.Callback(e.Column,e.RawResults)});n.listsInfo=c;d.resolve(c)}function i(e,t){console.log(t.get_message());d.reject(t.get_message())}}function o(e,t){console.log(t.get_message());d.reject(t.get_message())}}}function m(e,t){var n=a.defer();console.log(e);var r;if(c!==undefined){if(c[e]!==undefined){r=c[e];SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",l)})})}}else{}return n.promise;function l(){var e=r.DisplayName;var a=SP.ClientContext.get_current();var l=a.get_web();var o=l.get_lists().getByTitle(e);var i=new SP.ListItemCreationInformation;var u=o.addItem(i);var s=r.Columns;for(var p in s){if(s.hasOwnProperty(p)){var c=s[p];if(t[p]!==undefined){var d=t[p];var f=C(c,d);u.set_item(p,f)}}}u.update();a.load(u);a.executeQueryAsync(function(){n.resolve(u.get_id())},function(e,t){n.reject(t.get_message())})}}function g(e,t){var n=a.defer();return n.promise}function v(e,t){var n=a.defer();var r;var l;if(c!==undefined){if(c[e]!==undefined){r=c[e];l=t;SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",o)})})}}else{}return n.promise;function o(){var e=r.DisplayName;var t=SP.ClientContext.get_current();var a=t.get_web();var o=a.get_lists().getByTitle(e);var i=o.getItemById(l);t.load(i);t.executeQueryAsync(function(){var e=r.Columns;var a=i.get_fieldValues();var l={};var o=[];for(var u in e){if(e.hasOwnProperty(u)){var s=e[u];if(a[u]!==undefined){var p=a[u];if(p!==null){var c=I(s,p,o);l[u]=c}}}}if(o.length>0){t.executeQueryAsync(function(){o.forEach(function(e){e.Callback(e.Values,e.RawResults)});n.resolve(l)},function(e,t){n.reject(t.get_message())})}else{n.resolve(l)}},function(e,t){n.reject(t.get_message())})}}function y(e,t){}function h(e,t,n){}function T(e,t){var n=a.defer();var r=SP.ClientContext.get_current();var l=r.get_web();var o=l.get_lists().getByTitle(libraryName);var i=o.getItemById(t);i.deleteObject();r.executeQueryAsync(u,s);return n.promise;function u(){n.resolve()}function s(e,t){n.reject(e,t)}}function C(e,t){var n=null;switch(e.Type){case"text":case"choice":case"multiText":case"link":case"number":case"currency":n=t;break;case"multiChoice":n=[];for(var a in t){if(t.hasOwnProperty(a)){if(t[a]){n.push(a)}}}break;case"lookup":n=new SP.FieldLookupValue;n.set_lookupId(t);break;case"multiLookup":n=[];for(var a in t){if(t.hasOwnProperty(a)){if(t[a]){var r=new SP.FieldLookupValue;r.set_lookupId(a);n.push(r)}}}break;case"yesNo":if(t){n=1}else{n=0}break;case"person":if(t.length===1){var l=t[0];n=SP.FieldUserValue.fromUser(l.Key)}else if(t.length!==0){}break;case"multiPerson":n=[];for(var o=0;o<t.length;o++){var l=t[o];n.push(SP.FieldUserValue.fromUser(l.Key))}break;case"metadata":var i=e.TermsById[t];n=i.label+"|"+i.id;break;case"multiMetadata":var u=[];for(var a in t){if(t.hasOwnProperty(a)){if(t[a]){var i=e.TermsById[a];u.push("-1");u.push(i.label+"|"+i.id)}}}n=u.join(";#");break;case"dateTime":n=t.toISOString();break;default:break}return n}function I(e,t,n){var a;switch(e.Type){case"text":case"choice":case"multiText":case"link":case"number":case"currency":a=t;break;case"multiChoice":a={};for(var r=0;r<t.length;r++){var l=t[r];a[l]=true}break;case"lookup":a=t.get_lookupId();break;case"multiLookup":a={};for(var r=0;r<t.length;r++){var l=t[r].get_lookupId();a[l]=true}break;case"yesNo":if(t===1){a=true}else{a=false}break;case"person":a=[];var o=SP.ClientContext.get_current();var i=o.get_web();var u=i.getUserById(t.get_lookupId());o.load(u);n.push({Values:a,RawResults:u,Callback:k});break;case"multiPerson":a=[];var o=SP.ClientContext.get_current();var i=o.get_web();var s=[];for(var r=0;r<t.length;r++){var u=i.getUserById(t[r].get_lookupId());o.load(u);s.push(u)}n.push({Values:a,RawResults:s,Callback:k});break;case"metadata":a=t.get_termGuid();break;case"multiMetadata":a={};for(var r=0;r<t.get_count();r++){var l=t.getItemAtIndex(r);a[l.get_termGuid()]=true}break;case"dateTime":a=new Date(t);break;default:break}return a}function k(e,t){if(t.length>0){t.forEach(n)}else if(t!==null){n(t)}function n(t){var n={AutoFillDisplayText:t.get_title(),AutoFillKey:t.get_loginName(),Description:t.get_email(),DisplayText:t.get_title(),EntityType:"User",IsResolved:true,Key:t.get_loginName(),Resolved:true};e.push(n)}}function b(e,t,n){_(e,n)}function _(e,t){for(var n in t){if(t.hasOwnProperty(n)){var a=t[n].Columns;if(a!==undefined){x(e,a)}}}}function x(e,t){for(var n in t){if(t.hasOwnProperty(n)){var a=t[n];var r=e[n];if(r!==undefined){P(r,a)}}}}function P(e,t){for(var n in e){if(e.hasOwnProperty(n)){if(t[n]===undefined){t[n]=e[n]}}}}function S(e){var t=[];var n=SP.ClientContext.get_current();var a=n.get_web();var r=a.get_fields();for(var l in e){if(s.hasOwnProperty(l)){var o=r.getByInternalNameOrTitle(l);n.load(o);t.push(o)}}return t}function V(e,t){var n=SP.ClientContext.get_current();for(var a=0;a<t.length;a++){var r=t[a];var l=r.get_internalName();if(e[l]!==undefined){var o=e[l];w(o,r,0)}else{console.log("Field data mismatch.")}}}function w(e,t,n,a){var r=SP.ClientContext.get_current();e.Title=t.get_title();e.Id=t.get_id().toString();e.IsRequired=t.get_required();e.SchemaXml=t.get_schemaXml();e.DefaultValue=t.get_defaultValue();e.Scope=t.get_scope();e.FieldType=t.get_fieldTypeKind();switch(e.Type){case"text":if(e.FieldType===2){if(e.InputType===undefined){e.InputType="text"}}else{console.log(t.get_title()+": column type mismatch.")}break;case"multiText":if(e.FieldType===3){var l=r.castTo(t,SP.FieldMultiLineText);e.IsRichText=l.get_richText();if(e.InputType===undefined){if(e.IsRichText){e.InputType="nicEdit"}else{e.InputType="textBox"}}}else{console.log(t.get_title()+": column type mismatch.")}break;case"choice":if(e.FieldType===6){if(e.InputType===undefined){e.InputType="dropDown"}var o=r.castTo(t,SP.FieldChoice);e.Choices=o.get_choices();e.FillInChoice=o.get_fillInChoice();e.EditFormat=o.get_editFormat()}else{console.log(t.get_title()+": column type mismatch.")}break;case"multiChoice":if(e.FieldType===15){if(e.InputType===undefined){e.InputType="checkbox"}var i=r.castTo(t,SP.FieldMultiChoice);e.Choices=i.get_choices();e.FillInChoice=i.get_fillInChoice()}else{console.log(t.get_title()+": column type mismatch.")}break;case"lookup":if(e.FieldType===7){if(e.InputType===undefined){e.InputType="dropDown"}var u=r.castTo(t,SP.FieldLookup);var s=u.get_allowMultipleValues();if(!s){e.LookupField=u.get_lookupField();e.LookupList=u.get_lookupList();var p=D(e);n.push({Column:e,RawResults:p,Callback:$});a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"multiLookup":if(e.FieldType===7){if(e.InputType===undefined){e.InputType="checkbox"}var u=r.castTo(t,SP.FieldLookup);var s=u.get_allowMultipleValues();if(s){e.LookupField=u.get_lookupField();e.LookupList=u.get_lookupList();var p=D(e);n.push({Column:e,RawResults:p,Callback:$});a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"yesNo":if(e.FieldType===8){if(e.InputType===undefined){e.InputType="checkbox"}}else{console.log(t.get_title()+": column type mismatch.")}break;case"person":if(e.FieldType===20){if(e.InputType===undefined){e.InputType="peoplePicker"}var c=r.castTo(t,SP.FieldUser);e.SelectionGroup=c.get_selectionGroup();e.PeopleOnly=c.get_selectionMode()===0;var d=c.get_allowMultipleValues();if(!d){a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"multiPerson":if(e.FieldType===20){if(e.InputType===undefined){e.InputType="peoplePicker"}var c=r.castTo(t,SP.FieldUser);e.SelectionGroup=c.get_selectionGroup();e.PeopleOnly=c.get_selectionMode()===0;var d=c.get_allowMultipleValues();if(d){a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"metadata":if(e.FieldType===0){if(e.InputType===undefined){e.InputType="dropDown"}var f=N(e);if(f==="TaxonomyFieldType"){var m=M(e);n.push({Column:e,RawResults:m,Callback:O});a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"multiMetadata":if(e.FieldType===0){if(e.InputType===undefined){e.InputType="checkbox"}var f=N(e);if(f==="TaxonomyFieldTypeMulti"){var m=M(e);n.push({Column:e,RawResults:m,Callback:O});a++}else{console.log(t.get_title()+": column type mismatch.")}}else{console.log(t.get_title()+": column type mismatch.")}break;case"link":if(e.FieldType===11){if(e.InputType===undefined){e.InputType="text"}}else{console.log(t.get_title()+": column type mismatch.")}break;case"number":if(e.FieldType===9){if(e.InputType===undefined){e.InputType="text"}}else{console.log(t.get_title()+": column type mismatch.")}break;case"currency":if(e.FieldType===10){if(e.InputType===undefined){e.InputType="text"}}else{console.log(t.get_title()+": column type mismatch.")}break;case"dateTime":if(e.FieldType===4){if(e.InputType===undefined){e.InputType="dateTime"}}else{console.log(t.get_title()+": column type mismatch.")}break;default:break}return a}function L(e){var t=[];var n=SP.ClientContext.get_current();var a=n.get_web();for(var r in e){if(e.hasOwnProperty(r)){var l=e[r];var o=r;if(l.DisplayName!==undefined){o=l.DisplayName}var i=a.get_lists().getByTitle(o);if(l.Columns!==undefined){F(n,i,l.Columns,t)}else{}}}return t}function F(e,t,n,a){var r=t.get_fields();for(var l in n){if(n.hasOwnProperty(l)){var o=r.getByInternalNameOrTitle(l);e.load(o);a.push(o)}}}function D(e){var t=new SP.CamlQuery;var n=SP.ClientContext.get_current();var a=n.get_web();var r=a.get_lists().getById(e.LookupList);var l=r.getItems(t);n.load(l);return l}function M(e){var t=SP.ClientContext.get_current();var n=SP.Taxonomy.TaxonomySession.getTaxonomySession(t);var a=n.get_termStores();var r=a.getById(e.SspId);var l=r.getTermSet(e.TermSetId);var o=l.getAllTerms();t.load(o);return o}function $(e,t){e.LookupItems=[];e.LookupItemsById={};e.LookupItemsByLabel={};var n=t.getEnumerator();while(n.moveNext()){var a=n.get_current();var r=a.get_fieldValues();var l=r.ID;var o=r[e.LookupField];var i={id:l,label:o};e.LookupItems.push(i);e.LookupItemsById[l]=i;e.LookupItemsByLabel[o]=i}}function O(e,t){e.Terms=[];e.TermsById={};e.TermsByLabel={};var n=t.getEnumerator();while(n.moveNext()){var a=n.get_current();var r=a.get_id().toString();var l=a.get_name();var o={id:r,label:l};e.Terms.push(o);e.TermsById[r]=o;e.TermsByLabel[l]=o}}function B(e,t){var n=[];for(var a=0;a<t.length;a++){var r=t[a];var l=r.get_internalName();var o=r.get_scope();var i=o.split("/").pop();var u=e[i];if(u!==undefined&&u.Columns!==undefined){var s=u.Columns[l];if(u.LookupCount===undefined){u.LookupCount=0}u.LookupCount=w(s,r,n,u.LookupCount)}else{}}return n}function R(e){var t=a.defer();var n=SP.ClientContext.get_current();var r=n.get_web();var l=r.get_lists().getByTitle(e);n.load(l);n.executeQueryAsync(o,i);return t.promise;function o(){var e=l.get_id();t.resolve(e.toString())}function i(e,n){t.reject(e,n)}}function U(e,t){var n=a.defer();var r=SP.ClientContext.get_current();var l=r.get_web();var o=l.get_lists().getByTitle(e);var i=o.get_fields();var u=i.getByInternalNameOrTitle(t);r.load(u);r.executeQueryAsync(s,function(e,n){console.log(t);console.log(n.get_message())});return n.promise;function s(){n.resolve(u)}}function N(e){var n=t.parseXML(e.SchemaXml);var a=t(n);var r=a.find("Field");var l="";if(r!==undefined){l=r.attr("Type")}var o=a.find("Property");for(var i=0;i<o.length;i++){var u=o[i].firstChild.textContent===undefined?o[i].firstChild.text:o[i].firstChild.textContent;var s=o[i].lastChild.textContent===undefined?o[i].lastChild.text:o[i].lastChild.textContent;if(u!==s){switch(u){case"SspId":e.SspId=s;break;case"GroupId":e.GroupId=s;break;case"TermSetId":e.TermSetId=s}}}return l}function A(e,t,n){for(var a in e){if(e.hasOwnProperty(a)&&n[a]!==undefined&&n[a].display&&e[a].type!==undefined&&e[a].inputType!=undefined){var r=e[a].type;var l=e[a].inputType;var o=n[a].value;var i;switch(r){case"text":i=j(o,l);break;case"multiText":i=E(o,l);break;case"choice":i=G(o,l);break;case"multiChoice":i=E(o,l);break;case"lookup":i=processLookup(o,l);break;case"multiLookup":i=processMultiLookup(o,l);break;case"yesNo":i=X(o,l);break;case"person":i=processPerson(o,l);break;case"multiPerson":i=processMultiPerson(o,l);break;case"metadata":i=Q(o,l);break;case"multiMetadata":i=processMultiMetadata(o,l);break;case"link":i=processLink(o,l);break;case"number":i=processNumber(o,l);break;case"currency":i=processCurrency(o,l);break;case"dateTime":i=processDateTime(o,l);break;default:i=null;break}t.set_item(a,i)}}return t}return formSubmitPromise;function j(e,t){if(e!==undefined&&e!==""){return e}else{return null}}function E(e,t){if(e!==undefined&&e!==""&&e!=="<br>"){return e}else{return null}}function G(e,t){if(e!==undefined&&e!==""){return e}else{return null}}function Q(e,t){if(e!==undefined&&e!==""){var n=metadataItems[e];return n.label+"|"+e}else{return null}}function q(e,t){if(e!==undefined){var n=[];for(var a in e){if(fieldValues[a]){n.push("-1");n.push(metadataItems[a].label+"|"+a)}}return n.join(";#")}else{return null}}function K(e,t){if(e!==undefined&&e!==""){var n=new Date(e);return n.toISOString()}else{return null}}function X(e,t){if(e!==undefined&&e!==""){return e}else{return null}}function W(e,t){var n=programDetails[field];if(n!==undefined&&(visibleElements[field]||visibleElements[field]===undefined)){if(n.length>0){var a=n[0];var r=SP.FieldUserValue.fromUser(a.Key);return{fieldType:"user",value:r}}}return null}function Y(e,t){var n=programDetails[field];if(n!==undefined&&(visibleElements[field]||visibleElements[field]===undefined)){var a=[];for(var r=0;r<n.length;r++){var l=n[r];var o=SP.FieldUserValue.fromUser(l.Key);a.push(o)}if(a.length>0){return{fieldType:"user",value:a}}}return null}}})(angular,jQuery);