var app=app||angular.module("angularSP",["ui.bootstrap","ui.grid","ui.grid.selection"]);!function(e,t){function n(e){function n(e,t,n,l){e.$watch("ngspColumn",function(){void 0!==e.ngspColumn&&(t.html(""),t.append(a(e.ngspColumn)),t.append(void 0!==e.ngspReadOnly&&e.ngspReadOnly?m(l,e):o(t,l,e)))})}function a(e){var n=t("<label></label>");return n.text(e.Title),n}function o(e,t,n){switch(n.ngspColumn.InputType){case"text":return l(t,n);case"textBox":return u(t,n);case"nicEdit":return r(t,n);case"dropDown":return i(t,n);case"radio":return p(t,n);case"checkbox":return s(t,n);case"dateTime":return c(t,n);case"peoplePicker":return d(e,t,n);default:console.log(n.ngspColumn.InputType+" is currently unsupported as an input type.")}}function l(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e}),a.textInputChanged=function(){n.$setViewValue(a.InputValue)};var o=t("<input />");if(o.attr("data-ng-model","InputValue"),o.attr("data-ng-change","textInputChanged()"),"text"===a.ngspColumn.Type);else if("link"===a.ngspColumn.Type);else if("number"===a.ngspColumn.Type);else if("currency"!==a.ngspColumn.Type)return void console.log(a.ngspColumn.Type+"is not supported as a column type for text input.");return e(o)(a),o}function u(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e}),a.textAreaChanged=function(){n.$setViewValue(a.InputValue)};var o=t("<textarea></textarea>");return o.attr("data-ng-model","InputValue"),o.attr("data-ng-change","textAreaChanged()"),"multiText"!==a.ngspColumn.Type?void console.log(a.ngspColumn.Type+"is not supported as a column type for text box."):(e(o)(a),o)}function r(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e});var o=t("<span></span>"),l=t("<div></div>");o.append(l);var u=t("<div></div>");u.attr("contenteditable","true"),u.attr("data-ng-model","InputValue"),o.append(u);var r={iconsPath:"/AngularSP/lib/images/nicEditorIcons.gif"},i=new nicEditor(r);return i.setPanel(l[0]),i.addInstance(u[0]),"multiText"!==a.ngspColumn.Type?void console.log(a.ngspColumn.Type+"is not supported as a column type for nicEdit."):(e(o)(a),a.$watch("InputValue",function(){n.$setViewValue(a.InputValue)}),o)}function i(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e}),a.dropDownChanged=function(){n.$setViewValue(a.InputValue)};var o=t("<select></select>");if(o.attr("data-ng-model","InputValue"),o.attr("data-ng-change","dropDownChanged()"),"choice"===a.ngspColumn.Type)o.attr("data-ng-options","choice for choice in ngspColumn.Choices");else if("lookup"===a.ngspColumn.Type)o.attr("data-ng-options","lookupItem.id as lookupItem.label for lookupItem in ngspColumn.LookupItems");else{if("metadata"!==a.ngspColumn.Type)return void console.log(a.ngspColumn.Type+"is not supported as a column type for dropdown menus.");o.attr("data-ng-options","term.id as term.label for term in ngspColumn.Terms")}return e(o)(a),o}function s(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e}),a.checkboxChanged=function(){n.$setViewValue(a.InputValue)};var o=t("<span></span>");if("multiMetadata"===a.ngspColumn.Type||"multiLookup"===a.ngspColumn.Type||"multiChoice"===a.ngspColumn.Type){var l=t("<span></span>"),u=t("<input />");u.attr("data-ng-change","checkboxChanged()");var r=t("<label></label>");u.attr("type","checkbox"),"multiMetadata"===a.ngspColumn.Type?(l.attr("data-ng-repeat","term in ngspColumn.Terms"),u.attr("data-ng-model","InputValue[term.id]"),r.text("{{term.label}}")):"multiLookup"===a.ngspColumn.Type?(l.attr("data-ng-repeat","lookupItem in ngspColumn.LookupItems"),u.attr("data-ng-model","InputValue[lookupItem.id]"),r.text("{{lookupItem.label}}")):"multiChoice"===a.ngspColumn.Type&&(l.attr("data-ng-repeat","choice in ngspColumn.Choices"),u.attr("data-ng-model","InputValue[choice]"),r.text("{{choice}}")),l.append(u),l.append(r)}else{if("yesNo"!==a.ngspColumn.Type)return void console.log(a.ngspColumn.Type+"is not supported as a column type for checkboxes.");var u=t("<input />");u.attr("type","checkbox"),u.attr("data-ng-model","InputValue"),u.attr("data-ng-change","checkboxChanged()"),o.append(u)}return o.append(l),e(o)(a),o}function p(n,a){void 0!==n.$viewValue&&(a.InputValue=n.$viewValue),n.$formatters.push(function(e){a.InputValue=e}),a.radioChanged=function(){n.$setViewValue("yesNo"===a.ngspColumn.Type?"yes"===a.InputValue?!0:!1:a.InputValue)};var o=t("<span></span>"),l=a.ngspColumn.Title;if("yesNo"===a.ngspColumn.Type){var u=t("<span></span>"),r=t("<input></input>");r.attr("type","radio"),r.attr("data-ng-model","InputValue"),r.attr("data-ng-change","radioChanged()"),r.attr("name",l),r.attr("value","yes"),u.append(r);var i=t("<label></label>");i.text("Yes"),u.append(i);var s=t("<span></span>"),p=t("<input></input>");p.attr("type","radio"),p.attr("data-ng-model","InputValue"),p.attr("data-ng-change","radioChanged()"),p.attr("name",l),p.attr("value","no"),s.append(p);var c=t("<label></label>");c.text("No"),s.append(c),o.append(u),o.append(s)}else if("choice"===a.ngspColumn.Type){var d=t("<span></span>");d.attr("data-ng-repeat","choice in ngspColumn.Choices");var m=t("<input></input>");m.attr("type","radio"),m.attr("data-ng-change","radioChanged()"),m.attr("data-ng-model","$parent.InputValue"),m.attr("name",l),m.attr("value","{{choice}}");var g=t("<label></label>");g.text("{{choice}}"),d.append(m),d.append(g),o.append(d)}else if("lookup"===a.ngspColumn.Type){var f=t("<span></span>");f.attr("data-ng-repeat","lookupItem in ngspColumn.LookupItems");var m=t("<input></input>");m.attr("type","radio"),m.attr("data-ng-change","radioChanged()"),m.attr("data-ng-model","$parent.InputValue"),m.attr("name",l),m.attr("value","{{lookupItem.id}}");var g=t("<label></label>");g.text("{{lookupItem.label}}"),f.append(m),f.append(g),o.append(f)}else{if("metadata"!==a.ngspColumn.Type)return void console.log(a.ngspColumn.Type+"is not supported as a column type for radio input.");var v=t("<span></span>");v.attr("data-ng-repeat","term in ngspColumn.Terms");var m=t("<input></input>");m.attr("type","radio"),m.attr("data-ng-change","radioChanged()"),m.attr("data-ng-model","$parent.InputValue"),m.attr("name",l),m.attr("value","{{term.id}}");var g=t("<label></label>");g.text("{{term.label}}"),v.append(m),v.append(g),o.append(v)}return e(o)(a),o}function c(n,a){void 0!==n.$viewValue&&(a.InputValue={},a.InputValue.Date=n.$viewValue,a.InputValue.Time=n.$viewValue),n.$formatters.push(function(e){a.InputValue={},a.InputValue.Date=e,a.InputValue.Time=e}),a.calendarOpened=!1,a.calendarFormat="yyyy-MM-dd",a.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),a.calendarOpened=!0},a.dateTimeChanged=function(){var e=new Date;void 0!==a.InputValue.Date&&(e.setFullYear(a.InputValue.Date.getFullYear()),e.setMonth(a.InputValue.Date.getMonth()),e.setDate(a.InputValue.Date.getDate())),void 0!==a.InputValue.Time&&(e.setHours(a.InputValue.Time.getHours()),e.setMinutes(a.InputValue.Time.getMinutes())),e.setSeconds(0),n.$setViewValue(e)};var o=t("<span></span>");o.attr("class","input-group");var l=t("<span></span>");l.attr("class","input-group");var u=t("<input />");u.attr("class","form-control"),u.attr("data-ng-model","InputValue.Date"),u.attr("data-datepicker-popup","{{calendarFormat}}"),u.attr("data-is-open","calendarOpened"),u.attr("data-ng-change","dateTimeChanged()"),l.append(u);var r=t("<span></span>");r.attr("class","input-group-btn");var i=t("<button></button>");i.attr("class","btn btn-default"),i.attr("data-ng-click","openCalendar($event)");var s=t("<i></i>");s.attr("class","glyphicon glyphicon-calendar"),i.append(s),r.append(i),l.append(r),o.append(l);var p=t("<timepicker></timepicker>");return p.attr("data-ng-model","InputValue.Time"),p.attr("data-ng-change","dateTimeChanged()"),o.append(p),e(o)(a),o}function d(n,a,o){function l(){var e=u+"_TopSpan",t=SPClientPeoplePicker.SPClientPeoplePickerDict[e];o.InputValue=t.GetAllUserInfo(),a.$setViewValue(o.InputValue)}o.InputValue=void 0!==a.$viewValue?a.$viewValue:null;var u="pp_"+o.ngspColumn.Title+"_"+o.ngspColumn.Id,r=t("<span></span>");r.attr("id",u),e(r)(o);var i={SearchPrincipalSource:15,ResolvePrincipalSource:15,MaximumEntitySuggestions:50,Width:"100%",OnUserResolvedClientScript:l};if(i.Required=o.ngspColumn.IsRequired,i.PrincipalAccountType=o.ngspColumn.PeopleOnly?"User,DL":"User,DL,SecGroup,SPGroup","person"===o.ngspColumn.Type)i.AllowMultipleValues=!1;else{if("multiPerson"!==o.ngspColumn.Type)return void console.log(o.ngspColumn.Type+"is not supported as a column type for people pickers.");i.AllowMultipleValues=!0}return o.$watch(n[0].childNodes.length,function(){var e=t("#"+u);e.length>0&&(SPClientPeoplePicker_InitStandaloneControlWrapper(u,o.InputValue,i),a.$formatters.push(function(e){SPClientPeoplePicker_InitStandaloneControlWrapper(u,e,i)}))}),r}function m(n,a){function o(n,a){a.DisplayValue=n.$viewValue,n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function l(n,a){a.InputValue=n.$viewValue,n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.attr("data-ng-bind-html","DisplayValue"),e(o)(a),o}function u(n,a){a.InputValue=n.$viewValue,n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function r(n,a){n.$formatters.push(function(e){var t=[];for(var n in e)e[n]&&t.push(n);a.DisplayValue=t.join("; ")});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function i(n,a){n.$formatters.push(function(e){a.DisplayValue=a.ngspColumn.LookupItemsById[e].label});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function s(n,a){n.$formatters.push(function(e){var t=[];for(var n in e)if(e[n]){var o=a.ngspColumn.LookupItemsById[n].label;t.push(o)}a.DisplayValue=t.join("; ")});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function p(n,a){n.$formatters.push(function(e){a.DisplayValue=e?"Yes":"No"});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function c(n,a){n.$formatters.push(function(e){var t=[];e.forEach(function(e){t.push(e.AutoFillDisplayText)}),a.DisplayValue=t.join("; ")});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function d(n,a){n.$formatters.push(function(e){a.DisplayValue=a.ngspColumn.TermsById[e].label});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function m(n,a){n.$formatters.push(function(e){var t=[];for(var n in e)if(e[n]){var o=a.ngspColumn.TermsById[n].label;t.push(o)}a.DisplayValue=t.join("; ")});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function g(n,a){n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function f(n,a){n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function v(n,a){n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}function y(n,a){n.$formatters.push(function(e){a.DisplayValue=e});var o=t("<span></span>");return o.text("{{DisplayValue}}"),e(o)(a),o}switch(a.ngspColumn.Type){case"text":return o(n,a);case"multiText":return l(n,a);case"choice":return u(n,a);case"multiChoice":return r(n,a);case"lookup":return i(n,a);case"multiLookup":return s(n,a);case"yesNo":return p(n,a);case"person":case"multiPerson":return c(n,a);case"metadata":return d(n,a);case"multiMetadata":return m(n,a);case"link":return g(n,a);case"number":return f(n,a);case"currency":return v(n,a);case"dateTime":return y(n,a);default:console.log(a.ngspColumn.Type+" is currently unsupported as a column type.")}}return{restrict:"A",require:"ngModel",scope:{ngspColumn:"=",ngspReadOnly:"="},link:n}}function a(n,a){function o(e,t,n,a){e.$watch("ngspList",function(){void 0!==e.ngspList&&(t.html(""),t.append(l(e.ngspList)),t.append(u(a,e)),t.append(i(a,e)))})}function l(e){var n=t("<label></label>");return n.text(e.DisplayName),n}function u(e,t){return r(e,t)}function r(e,a){function o(e){a.gridApi=e,a.gridApi.selection.on.rowSelectionChanged(a,function(){a.selectedRow=a.gridApi.selection.getSelectedRows()[0]})}a.InputValues=void 0!==e.$viewValue?e.$viewValue:[],e.$formatters.push(function(e){console.log(e),a.InputValues=void 0!==e?e:[]});var l=[],u=a.ngspList.Columns;for(var r in u)if(u.hasOwnProperty(r)){var i=u[r];if(i.Show){var s={field:r};void 0!==i.DisplayName&&(s.displayName=i.DisplayName),l.push(s)}}a.uiGridOptions={data:a.InputValues,columnDefs:l,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,onRegisterApi:o};var p=t("<span></span>"),c=t("<div></div>");return c.attr("data-ui-grid","uiGridOptions"),c.attr("data-ui-grid-selection","true"),c.attr("class","grid"),p.append(c),n(p)(a),p}function i(o,l){l.createRow=function(){var e={},t=a.open({templateUrl:l.ngspTemplateUrl,controller:"listItemModalController",resolve:{item:function(){return e},columns:function(){return l.ngspList.Columns}}});t.result.then(function(e){l.InputValues.push(e),o.$setViewValue(l.InputValues)},function(e){console.log(e)})},l.updateRow=function(){if(void 0===l.selectedRow)alert("Nothing selected.");else{var t=a.open({templateUrl:l.ngspTemplateUrl,controller:"listItemModalController",resolve:{item:function(){return e.copy(l.selectedRow)},columns:function(){return l.ngspList.Columns}}});t.result.then(function(e){var t=l.InputValues.indexOf(l.selectedRow);l.InputValues[t]=e,o.$setViewValue(l.InputValues),l.selectedRow=void 0},function(e){console.log(e)})}},l.deleteRow=function(){if(void 0===l.selectedRow)alert("Nothing selected.");else{var e=l.InputValues.indexOf(l.selectedRow);l.InputValues.splice(e,1),o.$setViewValue(l.InputValues),l.selectedRow=void 0}},l.rowNotSelected=function(){return void 0===l.selectedRow?!0:!1};var u=t("<span></span>"),r=t("<input></input>");r.attr("type","button"),r.attr("value","Add"),r.attr("data-ng-click","createRow()"),u.append(r);var i=t("<input></input>");i.attr("type","button"),i.attr("value","Edit"),i.attr("data-ng-disabled","rowNotSelected()"),i.attr("data-ng-click","updateRow()"),u.append(i);var s=t("<input></input>");return s.attr("type","button"),s.attr("value","Delete"),s.attr("data-ng-disabled","rowNotSelected()"),s.attr("data-ng-click","deleteRow()"),u.append(s),n(u)(l),u}return{restrict:"A",require:"ngModel",scope:{ngspList:"=",ngspReadOnly:"=",ngspTemplateUrl:"@"},link:o}}app.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){function o(){var e=t.html();a.$setViewValue("<br>"===e?"":e)}a&&(a.$render=function(){t.html(a.$viewValue||"")},t.bind("blur keyup change",function(){e.$apply(o)}))}}}),app.directive("ngspColumn",["$compile",n]),app.directive("ngspList",["$compile","$modal",a])}(angular,jQuery);var app=app||angular.module("angularSP",["ui.bootstrap","ui.grid","ui.grid.selection"]);!function(e,t){function n(n,a){function o(){return _}function l(t,o,l){function u(){function e(){function e(){l.forEach(function(e){e.Callback(e.Column,e.RawResults)}),n.listsInfo=L,r.resolve(L)}function t(e,t){console.log(t.get_message()),r.reject(t.get_message())}_=o.get_serverRelativeUrl();var l=S(L,u);a.executeQueryAsync(e,t)}function t(e,t){console.log(t.get_message()),r.reject(t.get_message())}var a=SP.ClientContext.get_current(),o=a.get_web();a.load(o,"ServerRelativeUrl");var u=C(l);a.executeQueryAsync(e,t)}P=t,P=o,D=l,$=e.copy(t),F=e.copy(o),L=e.copy(l),f($,F,L);var r=a.defer();return SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",u)})}),r.promise}function u(e,t){function n(){var e=l.DisplayName,n=SP.ClientContext.get_current(),a=n.get_web(),u=a.get_lists().getByTitle(e),r=new SP.ListItemCreationInformation,i=u.addItem(r),s=l.Columns;for(var p in s)if(s.hasOwnProperty(p)){var c=s[p];if(void 0!==t[p]){var m=t[p],g=d(c,m);i.set_item(p,g)}}i.update(),n.load(i),n.executeQueryAsync(function(){o.resolve(i.get_id())},function(e,t){o.reject(t.get_message())})}var o=a.defer();console.log(e);var l;return void 0!==L&&void 0!==L[e]&&(l=L[e],SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",n)})})),o.promise}function r(e,t){function n(){for(var e=l.DisplayName,n=SP.ClientContext.get_current(),a=n.get_web(),u=a.get_lists().getByTitle(e),r=new SP.ListItemCreationInformation,i=[],s=0;s<t.length;s++){var p=t[s],c=u.addItem(r),m=l.Columns;for(var g in m)if(m.hasOwnProperty(g)){var f=m[g];if(void 0!==p[g]){var v=p[g],y=d(f,v);c.set_item(g,y)}}c.update(),i.push(c),n.load(c)}n.executeQueryAsync(function(){var e=[];i.forEach(function(t){e.push(t.get_id())}),o.resolve(e)},function(e,t){o.reject(t.get_message())})}var o=a.defer();console.log(e);var l;return void 0!==L&&void 0!==L[e]&&(l=L[e],SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",n)})})),o.promise}function i(e,t){function n(){var e=o.DisplayName,t=SP.ClientContext.get_current(),n=t.get_web(),a=n.get_lists().getByTitle(e),r=a.getItemById(l);t.load(r),t.executeQueryAsync(function(){var e=o.Columns,n=r.get_fieldValues(),a={},l=[];for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(void 0!==n[i]){var p=n[i];if(null!==p){var c=m(s,p,l);a[i]=c}}}l.length>0?t.executeQueryAsync(function(){l.forEach(function(e){e.Callback(e.Values,e.RawResults)}),u.resolve(a)},function(e,t){u.reject(t.get_message())}):u.resolve(a)},function(e,t){u.reject(t.get_message())})}var o,l,u=a.defer();return void 0!==L&&void 0!==L[e]&&(o=L[e],l=t,SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.executeFunc("sp.taxonomy.js","SP.Taxonomy.TaxonomySession",function(){SP.SOD.executeFunc("SP.UserProfiles.js","SP.UserProfiles.PeopleManager",n)})})),u.promise}function s(){}function p(){}function c(e,t){function n(){l.resolve()}function o(e,t){l.reject(t.get_message())}var l=a.defer();if(void 0!==L&&void 0!==L[e]&&void 0!==L[e].DisplayName){var u=L[e].DisplayName,r=SP.ClientContext.get_current(),i=r.get_web(),s=i.get_lists().getByTitle(u),p=s.getItemById(t);p.deleteObject(),r.executeQueryAsync(n,o)}else l.reject("Factory not initialized.");return l.promise}function d(e,t){var n=null;switch(e.Type){case"text":case"choice":case"multiText":case"link":case"number":case"currency":n=t;break;case"multiChoice":n=[];for(var a in t)t.hasOwnProperty(a)&&t[a]&&n.push(a);break;case"lookup":n=new SP.FieldLookupValue,n.set_lookupId(t);break;case"multiLookup":n=[];for(var a in t)if(t.hasOwnProperty(a)&&t[a]){var o=new SP.FieldLookupValue;o.set_lookupId(a),n.push(o)}break;case"yesNo":n=t?1:0;break;case"person":if(1===t.length){var l=t[0];n=SP.FieldUserValue.fromUser(l.Key)}else 0!==t.length;break;case"multiPerson":n=[];for(var u=0;u<t.length;u++){var l=t[u];n.push(SP.FieldUserValue.fromUser(l.Key))}break;case"metadata":var r=e.TermsById[t];n=r.label+"|"+r.id;break;case"multiMetadata":var i=[];for(var a in t)if(t.hasOwnProperty(a)&&t[a]){var r=e.TermsById[a];i.push("-1"),i.push(r.label+"|"+r.id)}n=i.join(";#");break;case"dateTime":n=t.toISOString()}return n}function m(e,t,n){var a;switch(e.Type){case"text":case"choice":case"multiText":case"link":case"number":case"currency":a=t;break;case"multiChoice":a={};for(var o=0;o<t.length;o++){var l=t[o];a[l]=!0}break;case"lookup":a=t.get_lookupId();break;case"multiLookup":a={};for(var o=0;o<t.length;o++){var l=t[o].get_lookupId();a[l]=!0}break;case"yesNo":a=1===t?!0:!1;break;case"person":a=[];var u=SP.ClientContext.get_current(),r=u.get_web(),i=r.getUserById(t.get_lookupId());u.load(i),n.push({Values:a,RawResults:i,Callback:g});break;case"multiPerson":a=[];for(var u=SP.ClientContext.get_current(),r=u.get_web(),s=[],o=0;o<t.length;o++){var i=r.getUserById(t[o].get_lookupId());u.load(i),s.push(i)}n.push({Values:a,RawResults:s,Callback:g});break;case"metadata":a=t.get_termGuid();break;case"multiMetadata":a={};for(var o=0;o<t.get_count();o++){var l=t.getItemAtIndex(o);a[l.get_termGuid()]=!0}break;case"dateTime":a=new Date(t)}return a}function g(e,t){function n(t){var n={AutoFillDisplayText:t.get_title(),AutoFillKey:t.get_loginName(),Description:t.get_email(),DisplayText:t.get_title(),EntityType:"User",IsResolved:!0,Key:t.get_loginName(),Resolved:!0};e.push(n)}t.length>0?t.forEach(n):null!==t&&n(t)}function f(e,t,n){v(e,n)}function v(e,t){for(var n in t)if(t.hasOwnProperty(n)){var a=t[n].Columns;void 0!==a&&y(e,a)}}function y(e,t){for(var n in t)if(t.hasOwnProperty(n)){var a=t[n],o=e[n];void 0!==o&&h(o,a)}}function h(e,t){for(var n in e)e.hasOwnProperty(n)&&void 0===t[n]&&(t[n]=e[n])}function I(e,t,n,a){var o=SP.ClientContext.get_current();switch(e.Title=t.get_title(),e.Id=t.get_id().toString(),e.IsRequired=t.get_required(),e.SchemaXml=t.get_schemaXml(),e.DefaultValue=t.get_defaultValue(),e.Scope=t.get_scope(),e.FieldType=t.get_fieldTypeKind(),e.Type){case"text":2===e.FieldType?void 0===e.InputType&&(e.InputType="text"):console.log(t.get_title()+": column type mismatch.");break;case"multiText":if(3===e.FieldType){var l=o.castTo(t,SP.FieldMultiLineText);e.IsRichText=l.get_richText(),void 0===e.InputType&&(e.InputType=e.IsRichText?"nicEdit":"textBox")}else console.log(t.get_title()+": column type mismatch.");break;case"choice":if(6===e.FieldType){void 0===e.InputType&&(e.InputType="dropDown");var u=o.castTo(t,SP.FieldChoice);e.Choices=u.get_choices(),e.FillInChoice=u.get_fillInChoice(),e.EditFormat=u.get_editFormat()}else console.log(t.get_title()+": column type mismatch.");break;case"multiChoice":if(15===e.FieldType){void 0===e.InputType&&(e.InputType="checkbox");var r=o.castTo(t,SP.FieldMultiChoice);e.Choices=r.get_choices(),e.FillInChoice=r.get_fillInChoice()}else console.log(t.get_title()+": column type mismatch.");break;case"lookup":if(7===e.FieldType){void 0===e.InputType&&(e.InputType="dropDown");var i=o.castTo(t,SP.FieldLookup),s=i.get_allowMultipleValues();if(s)console.log(t.get_title()+": column type mismatch.");else{e.LookupField=i.get_lookupField(),e.LookupList=i.get_lookupList();var p=V(e);n.push({Column:e,RawResults:p,Callback:x}),a++}}else console.log(t.get_title()+": column type mismatch.");break;case"multiLookup":if(7===e.FieldType){void 0===e.InputType&&(e.InputType="checkbox");var i=o.castTo(t,SP.FieldLookup),s=i.get_allowMultipleValues();if(s){e.LookupField=i.get_lookupField(),e.LookupList=i.get_lookupList();var p=V(e);n.push({Column:e,RawResults:p,Callback:x}),a++}else console.log(t.get_title()+": column type mismatch.")}else console.log(t.get_title()+": column type mismatch.");break;case"yesNo":8===e.FieldType?void 0===e.InputType&&(e.InputType="checkbox"):console.log(t.get_title()+": column type mismatch.");break;case"person":if(20===e.FieldType){void 0===e.InputType&&(e.InputType="peoplePicker");var c=o.castTo(t,SP.FieldUser);e.SelectionGroup=c.get_selectionGroup(),e.PeopleOnly=0===c.get_selectionMode();var d=c.get_allowMultipleValues();d?console.log(t.get_title()+": column type mismatch."):a++}else console.log(t.get_title()+": column type mismatch.");break;case"multiPerson":if(20===e.FieldType){void 0===e.InputType&&(e.InputType="peoplePicker");var c=o.castTo(t,SP.FieldUser);e.SelectionGroup=c.get_selectionGroup(),e.PeopleOnly=0===c.get_selectionMode();var d=c.get_allowMultipleValues();d?a++:console.log(t.get_title()+": column type mismatch.")}else console.log(t.get_title()+": column type mismatch.");break;case"metadata":if(0===e.FieldType){void 0===e.InputType&&(e.InputType="dropDown");var m=w(e);if("TaxonomyFieldType"===m){var g=k(e);n.push({Column:e,RawResults:g,Callback:b}),a++}else console.log(t.get_title()+": column type mismatch.")}else console.log(t.get_title()+": column type mismatch.");break;case"multiMetadata":if(0===e.FieldType){void 0===e.InputType&&(e.InputType="checkbox");var m=w(e);if("TaxonomyFieldTypeMulti"===m){var g=k(e);n.push({Column:e,RawResults:g,Callback:b}),a++}else console.log(t.get_title()+": column type mismatch.")}else console.log(t.get_title()+": column type mismatch.");break;case"link":11===e.FieldType?void 0===e.InputType&&(e.InputType="text"):console.log(t.get_title()+": column type mismatch.");break;case"number":9===e.FieldType?void 0===e.InputType&&(e.InputType="text"):console.log(t.get_title()+": column type mismatch.");break;case"currency":10===e.FieldType?void 0===e.InputType&&(e.InputType="text"):console.log(t.get_title()+": column type mismatch.");break;case"dateTime":4===e.FieldType?void 0===e.InputType&&(e.InputType="dateTime"):console.log(t.get_title()+": column type mismatch.")}return a}function C(e){var t=[],n=SP.ClientContext.get_current(),a=n.get_web();for(var o in e)if(e.hasOwnProperty(o)){var l=e[o],u=o;void 0!==l.DisplayName&&(u=l.DisplayName);var r=a.get_lists().getByTitle(u);void 0!==l.Columns&&T(n,r,l.Columns,t)}return t}function T(e,t,n,a){var o=t.get_fields();for(var l in n)if(n.hasOwnProperty(l)){var u=o.getByInternalNameOrTitle(l);e.load(u),a.push(u)}}function V(e){var t=new SP.CamlQuery,n=SP.ClientContext.get_current(),a=n.get_web(),o=a.get_lists().getById(e.LookupList),l=o.getItems(t);return n.load(l),l}function k(e){var t=SP.ClientContext.get_current(),n=SP.Taxonomy.TaxonomySession.getTaxonomySession(t),a=n.get_termStores(),o=a.getById(e.SspId),l=o.getTermSet(e.TermSetId),u=l.getAllTerms();return t.load(u),u}function x(e,t){e.LookupItems=[],e.LookupItemsById={},e.LookupItemsByLabel={};for(var n=t.getEnumerator();n.moveNext();){var a=n.get_current(),o=a.get_fieldValues(),l=o.ID,u=o[e.LookupField],r={id:l,label:u};e.LookupItems.push(r),e.LookupItemsById[l]=r,e.LookupItemsByLabel[u]=r}}function b(e,t){e.Terms=[],e.TermsById={},e.TermsByLabel={};for(var n=t.getEnumerator();n.moveNext();){var a=n.get_current(),o=a.get_id().toString(),l=a.get_name(),u={id:o,label:l};e.Terms.push(u),e.TermsById[o]=u,e.TermsByLabel[l]=u}}function S(e,t){for(var n=[],a=0;a<t.length;a++){var o=t[a],l=o.get_internalName(),u=o.get_scope(),r=u.split("/").pop(),i=e[r];if(void 0!==i&&void 0!==i.Columns){var s=i.Columns[l];void 0===i.LookupCount&&(i.LookupCount=0),i.LookupCount=I(s,o,n,i.LookupCount)}}return n}function w(e){var n=t.parseXML(e.SchemaXml),a=t(n),o=a.find("Field"),l="";void 0!==o&&(l=o.attr("Type"));for(var u=a.find("Property"),r=0;r<u.length;r++){var i=void 0===u[r].firstChild.textContent?u[r].firstChild.text:u[r].firstChild.textContent,s=void 0===u[r].lastChild.textContent?u[r].lastChild.text:u[r].lastChild.textContent;if(i!==s)switch(i){case"SspId":e.SspId=s;break;case"GroupId":e.GroupId=s;break;case"TermSetId":e.TermSetId=s}}return l}var _,P,D,$,F,L,R={initFactory:l,createListItem:u,createListItems:r,getListItem:i,getListItems:s,updateListItem:p,deleteListItem:c,getServerRelativeUrl:o};return R}app.factory("spListFactory",["$rootScope","$q",n])}(angular,jQuery);var app=app||angular.module("angularSP",["ui.bootstrap","ui.grid","ui.grid.selection"]);!function(){function e(e,t,n,a){e.item=n,e.columns=a,e.submit=function(e){t.close(e)},e.cancel=function(){t.dismiss("Canceled.")}}app.controller("listItemModalController",["$scope","$modalInstance","item","columns",e])}(angular,jQuery);